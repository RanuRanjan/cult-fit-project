<!DOCTYPE html>
<html>
<link rel="stylesheet" href="cart.css">

<head>
    <title>Cart</title>
</head>

<body>


    <!-- nav bar -->
    <div id="navBar">
        <div class="nav-CultFit-Logo" onclick="homePage()">
            <img src="https://static.cure.fit/assets/images/curefit-v-man.svg" class="nav-CultFit-Logo"
                onclick="homePage()" />
        </div>
    
        <!-- right -->
        <div class="nav-right">
            <div class="nav-login-Logo">
                <img src="https://static.cure.fit/assets/images/user-image.svg" alt=""  onclick="toProfile()"/>
            </div>

        </div>
    </div>





    <!-- Main container -->
    <div id="container">

        <!-- left order cart -->
        <div id="order-content">
            <div id="top">Cultgear Order Summary</div>
        </div>


        <div id="address">

            <!-- address select section -->
            <div oncilck="call()" id="selectAddress">

               <div class="modify-address-div">
                    <p oncilck="call()" id="addleft">
                        <span>
                            <img src="https://static.cure.fit/assets/images/locationPink.svg" class="location-icon">
                        </span> Please Add Addresses
                    </p>
                    
                    <!-- modify address -->
                    <p oncilck="call()" id="addright">Add/Modify</p>
               </div>
                <hr class="line">
            </div>


            <!-- Price -->
            <div id="pricePart">

                <div id="totalPrice">
                    <p class="total-price">Total Price</p>
                    <p id="showTotalPrice"> ₹ 0</p>
                </div>

                <div id="discount">
                    <p class="discount-text">(-) Discount</p>
                    <p id="showTotalDiscount"> ₹ 0</p>
                </div>

                <div id="voucher">
                    <p class="implement-voucher">Implement voucher</p><span id="discountamount"></span>
                    <button onclick="voucher()" class="voucher-btn">Check</button>
                </div>

                <div id="totalPayble">
                    <p class="total-payable">Total Payble</p>
                    <p id="showTotalPaybleAmount"> ₹ 0</p>
                </div>
            </div>


            <!-- Address button -->
            <div id="addressbutton">
                <button onclick="call()" id="addressselectbutton">Select Address</button>
                <button onclick="checkout()" id="checkoutbutton">Checkout</button>
            </div>
        </div>
    </div>



    <!--Modal Adding address box-->
    <div id="modal">
        <div id="modal-content">
            <div id="model-header">
                <p id="model-left">Choose Delivery Address</p>
                <span onclick="clos()" class="close">&times;</span>
            </div>

            <hr>

            <div id="modal-body" class="model-body">
                <div id="addCity">
                    <input type="text" id="cityname" placeholder="Enter your full address....">
                </div>

                <div id="button">
                    <button onclick="addressAdd()" id="addbtn">Add New Address</button>
                </div>

            </div>
        </div>
    </div>

    <!--End modal box-->



    <!--Model for checkout form-->
    <div id="modal1">
        <div id="modal-content">
            <div id="model-header">
                <p style="text-align:center" id="model-left">Payment Option</p>
                <span onclick="closP()" class="close">&times;</span>
            </div>
            <hr>
            <div id="modal-body" class="model-body">
                <button onclick="paymentPage()">Add Debit & Credit Card</button>
                <button onclick="orderPage()">Pay On Delivery</button>

            </div>
        </div>
    </div>
</body>

</html>

<script>
//     const orders = [
//         {
//             name: "T-shirt minimal",
//             price: 345,
//             discount: 30,
//             brand: "cultsport",
//             id: 123456,
//             image: "https://cdn-images.cure.fit/www-curefit-com/image/upload/fl_progressive,f_auto,q_auto:eco,w_125,ar_5:6,c_fit/dpr_2/cultgear-content/yU6ThYdaF6A74mhqPqeYzN27",
//             size: "S"
//         }
//     ];



//  localStorage.setItem("orders", JSON.stringify(orders));


    //modal checkout
    function checkout() {
        document.getElementById("modal1").style.display = "block";
    }


    //voucher implement test
    function voucher() {
        var get_voucher = JSON.parse(localStorage.getItem("user"));
        var logedin = JSON.parse(localStorage.getItem("logedin"));
        get_voucher.forEach(function (p) {
            if (p.number == "8250248991") {

                if (p.voucher.length == 0) {
                    alert("You have no voucher");
                    //  console.log("work");

                } else {
                    var voucherApply = document.getElementById("showTotalPaybleAmount");
                    voucherApply.innerText = "";
                    var all_orders = JSON.parse(localStorage.getItem("orders"));
                    var price;
                    all_orders.forEach(function (p) {
                        price = Number(Number(p.discountPrice) - Number(Number(p.discountPrice) * Number(Number(p.discount) / 100)));

                    })
                    voucherApply.innerText = "₹" + Number(price - Number(p.voucher[0]));

                }
            }
        });
    }




    function addressAdd() {
        var parent = document.getElementById("modal-body");
        var get = JSON.parse(localStorage.getItem("user"));
        var citya = document.getElementById("cityname").value;
        get.forEach(function (q) {
            q.city = citya;

            localStorage.setItem("user", JSON.stringify(get));
        })

        citya = "";

    }

    //right div 
    function PriceAddress() {
        var parent = document.getElementById("address");
        var get_data = JSON.parse(localStorage.getItem("orders"));

    }


    //Address modal 
    // function addressModal() {
    //     var modal = document.getElementById("modal");
    //         modal.style.display = "block";
    // }

    function call() {
        var modal = document.getElementById("modal");
        modal.style.display = "block";
        // if(localStorage.getItem("address") == null) {
        //     localStorage.setItem("address", JSON.stringify([]));

        // } else {


        var logedin_user = JSON.parse(localStorage.getItem("logedin"));

        var get_user = JSON.parse(localStorage.getItem("user"));

        get_user.forEach(function (p) {
            // p.address = {city: "khirpai"}
            // p.address = "Khirpai";
            if (p.number == logedin_user.n) {
                // console.log(p.address);
                // console.log(p.address.city);
                if (p.address == undefined) {
                    // alert("Add new address");

                    document.getElementById("addCity").style.display = "block";

                    document.getElementById("addbtn").addEventListener("click", function () {
                        var cityName = document.getElementById("cityname").value;
                        p.address = cityName;

                        document.getElementById("model-left").innerHTML = p.address;
                        document.getElementById("addleft").innerHTML = "<span><img src = 'https://static.cure.fit/assets/images/locationPink.svg'></span>" + p.address;


                        // document.getElementById("cityname").innerHTML = '';

                        document.getElementById("addressselectbutton").style.display = "none";
                        document.getElementById("checkoutbutton").style.display = "block";
                        clos();

                    });

                } else {
                    // document.getElementById("addCity").style = "";
                    let showAddress = document.createElement('div');
                    // var str = "";
                    // for (x in p.address) {
                    //     str += p[address[x]];
                    // }
                    // console.log(p.address.city)
                    showAddress.innerText = p.address;

                    showAddress.id = "saveAddress";
                    showAddress.addEventListener("click", function () {
                        document.getElementById("model-left").innerHTML = p.address;

                        showAddress.style.display = "none";

                        document.getElementById("model-left").innerHTML = p.address;

                        document.getElementById("addleft").innerHTML = "<span><img src = 'https://static.cure.fit/assets/images/locationPink.svg'></span>" + p.address;

                        document.getElementById("addressselectbutton").style.display = "none";

                        document.getElementById("checkoutbutton").style.display = "block";

                        clos();
                    });

                    document.getElementById("modal-body").insertBefore(showAddress, document.getElementById("button"));
                }
            }

        })

        // }
    }
    // call();
    document.getElementById("selectAddress").addEventListener("click", call);

    function clos() {
        var modal = document.getElementById("modal");

        modal.style.display = "none";

    }

    function closP() {
            var modal1 = document.getElementById("modal1");

            modal1.style.display = "none";

        }





















    //left div

    function order() {

        // const array = [];

        var all_orders = JSON.parse(localStorage.getItem("orders"));
        console.log(all_orders);
        
        // array.push(all_orders)
        var parent = document.getElementById("order-content");
        // let h2 = document.createElement("h2");
        //     h2.innerText = "Cultgear Order Summary";

        all_orders.forEach(function (p) {

            let total_div = document.createElement("div");

            total_div.id = "one_content";
            // let product_content = document.createElement("div");
            let left_div = document.createElement("div");
            left_div.id = "image_div";
            let imagea = document.createElement("img");
            imagea.src = p.image[0];
            imagea.id = "image";
            // left_div.class = "image_container;"
            left_div.append(imagea);
            let right_div = document.createElement("div");


            //name

            let cross = document.createElement("p");
            cross.innerText = "X";
            cross.id = "cross";
            // cross.addEventListener("click", orderDelete)
            let name_right = document.createElement("p");
            name_right.innerText = p.name;
            name_right.id = "name_right";
            let first = document.createElement("div");
            first.append(name_right, cross);

            first.id = "first";




            //band name
            let band = document.createElement("p");
            band.innerText = p.brand;
            band.id = "band";



            //size 
            let size = document.createElement("p");
            size.innerText = "Size: " + p.size;
            size.id = "size";



            let priceQuantity = document.createElement("div");
            priceQuantity.id = "priceQuantity";

            let priceP = document.createElement("p");
            priceP.innerText = "₹ " + p.price;

            let quantity = document.createElement("div");
            quantity.id = "quantity";

            let p_minus = document.createElement("p");
            p_minus.innerText = " - ";
            p_minus.id = "p_minus";


            let p_plus = document.createElement("p");
            p_plus.innerText = " + ";
            p_plus.id = "p_plus";

            //Only for test purposes
            p.discount = 300;


            let p_quantity = document.createElement("p");

            p_quantity.innerText = 1;

            p_quantity.id = "p_quantity";
            // var count = Number(document.getElementById("p_quantity").innerHTML);
            var total_price = document.getElementById("showTotalPrice");
            total_price.innerText = "₹ " + Number(p.price);

            var total_discount = document.getElementById("showTotalDiscount");

            total_discount.innerText = "₹ " + Number(Number(p.discount));
            var total_payble_amount = document.getElementById("showTotalPaybleAmount");

            total_payble_amount.innerText = "₹ " + Number(Number(p.price) - Number(p.discount));



            p_plus.addEventListener("click", function () {
                var count = Number(document.getElementById("p_quantity").innerHTML);

                count = count + 1;

                p_quantity.innerHTML = count;

                var total_price = document.getElementById("showTotalPrice");
                
                total_price.innerText = "₹ " + Number(p.price * count);
                var total_discount = document.getElementById("showTotalDiscount");

                total_discount.innerText = "₹ " + Number(Number(p.discount) * count);

                var total_payble_amount = document.getElementById("showTotalPaybleAmount");

                total_payble_amount.innerText = "₹ " + Number((Number(p.price) * count) - Number(Number(p.discount) * count));





            });


            p_minus.addEventListener("click", function () {
                
                var count = Number(document.getElementById("p_quantity").innerHTML);
                if (count >= 1) {
                    count = count - 1;
                    p_quantity.innerText = count;
                    var total_price = document.getElementById("showTotalPrice");
                    total_price.innerText = "₹" + Number(p.price * count);
                    var total_discount = document.getElementById("showTotalDiscount");
                    total_discount.innerText = "₹" + Number(Number(p.discount) * count);
                    var total_payble_amount = document.getElementById("showTotalPaybleAmount");
                    total_payble_amount.innerText = "₹" + Number((Number(p.price) * count) - Number(Number(p.discount) * count));

                    if (count == 0) {

                        window.location = "home.html";
                    }

                }
            });


            let br = document.createElement("br");

            let hr = document.createElement("hr");

            quantity.append(p_minus, p_quantity, p_plus);

            priceQuantity.append(priceP, quantity);

            right_div.append(first, br, band, br, size, br, priceQuantity);

            total_div.append(left_div, right_div);
            
            parent.append(total_div, hr);
        });
    }
    order();
    function increment() {
        console.log("This is the name of the file");
    }
    function decrement() {

    }

    function homePage() {
            window.location.pathname = "main/home.html"
        }

    function toProfile(){
        window.location.pathname = "main/settings/profile.html"
    }

    function paymentPage(){
        window.location.pathname = "main/payment/payment.html"
    }

    function orderPage(){
        window.location.pathname = "main/orderConfirm/order.html"
    }
</script>